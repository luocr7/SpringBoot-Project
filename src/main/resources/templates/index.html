<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>Luo's Blog</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}" media="all">
    <link rel="icon" type="image/x-icon" th:href="@{/layui/Soccer Ball.ico}">
    <style>
        html,body{
            margin: 0;
            padding: 0;
            background-color: mintcream;
        }
    </style>
</head>

<ul class="layui-nav" style="background-color: mediumturquoise">
    <h1 style="position: absolute;left: 42%;top:0;color: #ddf3f5;font-size: 50px">Life-Amazing</h1>

    <li class="layui-nav-item" style="left:88%" th:if="${isLogin}">
        <a href="" style="color: seashell;font-size: large;font-family: Cambria;"><cite style="font-family: Elephant;padding: 10px;font-size: x-large" class="layui-hide-xs" th:text="${userName}"></cite><img style="width: 45px;height: 45px" th:src="${imgName}" onerror="this.src='/layui/background.jpg;this.onerror=null'" class="layui-nav-img"></a>
        <dl class="layui-nav-child" >
            <dd><a href="/personal">个人信息</a></dd>
            <dd><a href="/safety">安全管理</a></dd>
            <dd><a th:if="${admin}" href="/ArticleManager">文章管理</a></dd>
            <dd><a href="/logout">注销</a></dd>
        </dl>
    </li>

    <li class="layui-nav-item" style="left: 88%" th:unless="${isLogin}">
        <a href="/login" style="color: #0C0C0C">
            <i class="layui-icon layui-icon-user" style="font-size: 20px"></i>登录</a>
    </li>
    <li class="layui-nav-item" style="left: 86%;" th:unless="${isLogin}">
        <a href="/register" style="color: #0C0C0C">
        <i class="layui-icon layui-icon-set" style="font-size: 20px"></i>注册</a>
    </li>
</ul>


    <div style="position: absolute;
    top: 12%;
    left: 2%;
    width: 250px;
    height:500px;
    border-left-style: solid;
    border-left-color: gainsboro;
    border-left-width: thin;
    border-right-style: solid;
    border-right-color: gainsboro;
    border-right-width: thin;
    border-top-style: solid;
    border-top-color: gainsboro;
    border-top-width: thin;
    border-bottom-style: solid;
    border-bottom-color: gainsboro;
    border-bottom-width: thin;
    z-index: 1;"><!--用户信息-->
        <img th:src="@{/layui/touxiang.jpg}" width="100%" height="100%" style="position: absolute;
    top: 0px;
    left: 92px;
    width: 60px;
    height: 60px;
    z-index: 100;
    border-right-style: solid;
    border-right-color: gainsboro;
    border-right-width: thin;
    border-bottom-style: solid;
    border-bottom-color: gainsboro;
    border-bottom-width: thin;
    border-top-style: solid;
    border-top-color: gainsboro;
    border-top-width: thin;
    border-left-style: solid;
    border-left-color: gainsboro;
    border-left-width: thin;
    border-top-right-radius: 100%;
    border-top-left-radius: 100%;
    border-bottom-right-radius: 100%;
    border-bottom-left-radius: 100%;">
        <img th:src="@{/layui/timg1.gif}" width="100%" height="100%">
        <h1 style="color: #eb7350;font-size: large;
          position: absolute;
          top: 65px;
          left: 88px;
        ">Dreamer</h1>
        <p style="position: absolute;
           top: 200px;
           left: 40px;
           font-size: x-large;
           color: deeppink;
           font-family: 华文行楷 ;
        ">
        </p>
    </div>


<!--<ul class="layui-timeline" id="pageContent">
    <li class="layui-timeline-item" style="left: 500px;" th:each="content:${contentList}">
        <i class="layui-icon layui-timeline-axis"></i>
        <div class="layui-timeline-content layui-text">
            <h3 class="layui-timeline-title" th:text="${content.getTopic()+'--'+content.getTime()}"></h3>
            <div th:utext="${content.getContent()}" style="word-wrap:break-word;word-break: break-all"></div>
        </div>
    </li>
    <li class="layui-timeline-item" style="left: 500px">
        <i class="layui-icon layui-timeline-axis"></i>
        <div class="layui-timeline-content layui-text">
            <div class="layui-timeline-title">过去</div>
        </div>
    </li>
</ul>!-->

<ul class="contentUl" id="pageContent" style="position:absolute;left: 27%;top: 12%;overflow-y:auto;overflow-x: hidden;
word-break: break-all;word-wrap: break-word" th:text="${content}">
</ul>


<div id="test1" style="position:absolute;top:600px;left: 27%"></div>



<ul class="talkUl" style="position: absolute;overflow: auto;
    top: 15%;
    left: 70%;
    width: 350px;
    height:500px;
    z-index: 1;" id="talkUl">
    <div style="top:-50px">评论区</div>
    <!--<li class="talkLi" >
        <div class="user" id="ArticleName">

            <div class="time" id="ArticleTime">

            </div>
        </div>
        <p class="talkContent" id="ArticleContent">
        </p>
    </li>!-->
</ul>
<div class="layui-form-item layui-form-text" style="width: 400px;height: 400px;position: absolute;
 left: 66%;top: 600px;">
    <label class="layui-form-label">评论</label>
    <div class="layui-input-block" th:unless="${isLogin}">
        <textarea placeholder="登录后发表评论" class="layui-textarea" readonly="true"></textarea>
        <a style="position: absolute;left: 45%;top: 40%" href="/login" class="loginA">登录</a>
    </div>

    <div class="layui-input-block" style="position: absolute;top:3%;width: 75%" th:if="${isLogin}">
        <textarea class="layui-textarea" id="commentContent"></textarea>
        <button id="submitComment"  class="layui-btn layui-btn-normal" style="position: absolute;
    left: 78%;top: 100%">发表</button>
    </div>
</div>

<div class="site-demo-laydate" style="position: absolute;top: 700px;left:400px">
    <div class="layui-inline" id="test-n1"></div>

</div>

<link rel="stylesheet" th:href="@{/layui/css/talk.css}">

<script th:src="@{/layui/layui.js}" type="text/javascript"></script>
<script type="text/javascript" th:src="@{/wangEditor-3.1.1/release/wangEditor.min.js}"></script>
<script type="text/javascript" th:src="@{/wangEditor-3.1.1/release/jQuery.js}"></script>
<script th:src="@{/ZUI/dist/lib/jquery/jquery.js}"></script>
<script th:inline="javascript">

    layui.use('laydate',function () {
        var laydate=layui.laydate;

        laydate.render({
            elem: '#test-n1'
            ,position: 'static'
        });
    })

        layui.use('element',function (elem) {
            var element=layui.element;
        });

        var ArticleId;
        var getIdbyTopic;
        var len;
          var pageNum=[[${pageNum}]]
        var pageSize=[[${pageSize}]]
        var data=[[${content}]]
        var topic=[[${topic}]]
        var contentTime=[[${time}]]
        var userName=[[${userName}]]
        var commentName;
            layui.use('laypage', function () {
                var laypage = layui.laypage;

                //执行一个laypage实例
                laypage.render({
                    elem: 'test1' //注意，这里的 test1 是 ID，不用加 # 号
                    , count: pageNum//数据总数，从服务端得到
                    ,limit:pageSize
                    ,jump:function (obj) {
                        document.getElementById('pageContent').innerHTML=function () {
                            var arr=[]
                                ,thisData=data.concat().splice(obj.curr*obj.limit-obj.limit,obj.limit);
                            layui.each(thisData,function (index,item) {
                                arr.push('<li class="layui-timeline-item" style="font-weight: bold;height: 500px;">'
                                    +'<i class="layui-icon layui-timeline-axis"></i>'+
                                    '<div class="layui-timeline-content layui-text" ' +
                                    'style="color: #0C0C0C; font-family: 华文行楷;font-size: x-large" >'+
                                    '<h3  class="layui-timeline-title" style="font-family: Jokerman;font-weight: bold">'+contentTime[(obj.curr-1)*obj.limit+index]+'</h3>'+'<h2 style="font-size: xx-large;color: #40AFFE;position: relative;top:-15px;left: 150px">'+topic[(obj.curr-1)*obj.limit+index]+'</h2>'
                                        +item
                                +'</li>');
                                ArticleId=(obj.curr-1)*obj.limit+index+1;
                                getIdbyTopic=topic[(obj.curr-1)*obj.limit+index];
                                $('#talkUl').empty()
                                $.ajax({
                                    url:"/getArticleId",
                                    type:"post",
                                    data:{'getIdbyTopic':getIdbyTopic},
                                    success:function (data) {
                                        len=data.ArticleLength
                                         for (var i=0;i<len;i++){
                                             commentName=data.ArticleName[i]
                                             $('#talkUl').append('<li p="'+data.ArticleTime[i]+'" value="'+data.content[i]+'" id="'+data.ArticleName[i]+'" class="talkLi">'+'<div class="user">'+
                                               data.ArticleName[i]+'<div class="time">'+data.ArticleTime[i]+'</div>'+'</div>'+
                                                 '<p class="talkContent">'+data.content[i]+'</p>'+'</li>')
                                         }
                                    },
                                    error:function (xhr) {
                                        alert(xhr)
                                    }
                                })
                            });
                            return arr.join('');
                        }();
                    }
                });
            });

        layui.use('layer',function () {
            var layer=layui.layer
            $('#submitComment').click(function () {
                $.ajax({
                    url: "/addComment",
                    type: "post",
                    data: {'content': $('#commentContent').val(),'getIdbyTopic':getIdbyTopic},
                    success: function (data) {
                        $('#commentContent').val("")
                        layer.msg(data, {icon: 6})
                        $('#talkUl').empty()
                        $.ajax({
                            url:"/getArticleId",
                            type:"post",
                            data:{'getIdbyTopic':getIdbyTopic},
                            success:function (data) {
                                len=data.ArticleLength;
                                for (var i=0;i<len;i++){
                                    $('#talkUl').append('<li p="'+data.ArticleTime[i]+'" value="'+data.content[i]+'" id="'+data.ArticleName[i]+'" class="talkLi">'+'<div class="user">'+
                                        data.ArticleName[i]+'<div class="time">'+data.ArticleTime[i]+'</div>'+'</div>'+
                                        '<p class="talkContent">'+data.content[i]+'</p>'+'</li>')
                                }
                            },
                            error:function (xhr) {
                                alert(xhr)
                            }
                        })
                    },
                    error: function (xhr) {
                        layer.msg(xhr, {icon: 5})
                    }
                })
            })
        })

            $(document).on("click", ".talkLi", function () {
                var commentVal=$(this).attr("value")
                var commentTime=$(this).attr("p")
                if ($(this).attr("id")==userName) {
                    layui.use('layer', function () {
                        var layer = layui.layer
                        layer.msg('是否删除?', {
                            btn: ['是', '否']
                            ,btn1:function () {
                                $.ajax({
                                    url:"/deleteComment",
                                    type:"post",
                                    data:{"commentContent":commentVal,"commentTime":commentTime},
                                    success:function (data) {
                                        layer.msg(data)
                                        $('#talkUl').empty()
                                        $.ajax({
                                            url:"/getArticleId",
                                            type:"post",
                                            data:{'getIdbyTopic':getIdbyTopic},
                                            success:function (data) {
                                                len=data.ArticleLength
                                                for (var i=0;i<len;i++){
                                                    $('#talkUl').append('<li p="'+data.ArticleTime[i]+'" value="'+data.content[i]+'" id="'+data.ArticleName[i]+'" class="talkLi">'+'<div class="user">'+
                                                        data.ArticleName[i]+'<div class="time">'+data.ArticleTime[i]+'</div>'+'</div>'+
                                                        '<p class="talkContent">'+data.content[i]+'</p>'+'</li>')
                                                }
                                            },
                                            error:function (xhr) {
                                                alert(xhr)
                                            }
                                        })
                                    },
                                    error:function (xhr) {
                                        layer.msg(xhr)
                                    }
                                })
                            }
                        })
                    })
                }
                })


</script>
</body>
</html>